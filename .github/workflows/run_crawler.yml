name: Run NIA Crawler and Commit Result

on:
  # 1. ì£¼ê¸°ì  ì‹¤í–‰ ì„¤ì • (Periodic Execution)
  #    - ë§¤ì¼ UTC ê¸°ì¤€ 23:00ì— ì‹¤í–‰ë©ë‹ˆë‹¤. (í•œêµ­ ì‹œê°„ ê¸°ì¤€ ì˜¤ì „ 8ì‹œ)
  schedule:
    - cron: '0 23 * * *' 
    
  # 2. ìˆ˜ë™ ì‹¤í–‰ ì„¤ì • (Manual Execution)
  #    - GitHub Actions íƒ­ì—ì„œ 'Run workflow' ë²„íŠ¼ìœ¼ë¡œ ì§ì ‘ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
  workflow_dispatch:

# ğŸ’¡ í™˜ê²½ ë³€ìˆ˜
env:
  PYTHON_VERSION: '3.11'

jobs:
  run_python_script:
    runs-on: ubuntu-latest
    
    steps:
      # 1. ë ˆí¬ì§€í† ë¦¬ ì²´í¬ì•„ì›ƒ ë° ê¶Œí•œ ì„¤ì •
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          # ë³€ê²½ ì‚¬í•­(nia.json)ì„ ì»¤ë°‹í•˜ê¸° ìœ„í•´ í•„ìš”í•©ë‹ˆë‹¤.
          token: ${{ secrets.GITHUB_TOKEN }}
          persist-credentials: false
          fetch-depth: 0 

      # 2. Python í™˜ê²½ ì„¤ì •
      - name: Set up Python ${{ env.PYTHON_VERSION }}
        uses: actions/setup-python@v5
        with:
          python-version: ${{ env.PYTHON_VERSION }}

      # 3. í•„ìš”í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„¤ì¹˜ (requirements.txt ì‚¬ìš©)
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt
          
      # 4. Python ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ (codes/02.2ë‹¨ê³„.py)
      - name: Run Python script
        # ìŠ¤í¬ë¦½íŠ¸ê°€ 'nia.json'ì„ í˜„ì¬ ë””ë ‰í† ë¦¬(ë£¨íŠ¸)ì— ì €ì¥í•©ë‹ˆë‹¤.
        run: python codes/02.2ë‹¨ê³„.py

      # 5. ë³€ê²½ëœ íŒŒì¼ (nia.json) ìë™ ì»¤ë°‹ ë° í‘¸ì‹œ
      - name: Commit and Push changes
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          file_pattern: 'nia.json'
          commit_message: 'Automated: Update NIA Web Crawler data'
          branch: main # ğŸ’¡ ì‚¬ìš©í•˜ì‹œëŠ” ë©”ì¸ ë¸Œëœì¹˜ ì´ë¦„ì— ë§ê²Œ ìˆ˜ì •í•˜ì„¸ìš” (ì˜ˆ: master ë˜ëŠ” main)
