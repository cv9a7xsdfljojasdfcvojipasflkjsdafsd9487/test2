name: Run NIA Crawler and Commit Result

# ğŸ’¡ 1. ë ˆí¬ì§€í† ë¦¬ ì½˜í…ì¸ ì— ì“°ê¸° ê¶Œí•œì„ ë¶€ì—¬í•©ë‹ˆë‹¤. (ìë™ ì»¤ë°‹/í‘¸ì‹œë¥¼ ìœ„í•´ í•„ìˆ˜)
permissions:
  contents: write

on:
  # 2. ì£¼ê¸°ì  ì‹¤í–‰ ì„¤ì • (ë§¤ì¼ UTC 23:00, í•œêµ­ ì‹œê°„ ì˜¤ì „ 8ì‹œ)
  schedule:
    - cron: '0 23 * * *' 
    
  # 3. ìˆ˜ë™ ì‹¤í–‰ ì„¤ì • (Actions íƒ­ì—ì„œ ë²„íŠ¼ìœ¼ë¡œ ì‹¤í–‰ ê°€ëŠ¥)
  workflow_dispatch:

# ğŸ’¡ í™˜ê²½ ë³€ìˆ˜
env:
  PYTHON_VERSION: '3.11' # ğŸ‘ˆ pandas ë²„ì „ ì¶©ëŒ í•´ê²°ì„ ìœ„í•´ 3.11ë¡œ ì„¤ì •

jobs:
  run_python_script:
    runs-on: ubuntu-latest
    
    steps:
      # 1. ë ˆí¬ì§€í† ë¦¬ ì²´í¬ì•„ì›ƒ (ì½”ë“œì™€ ê¸°ì¡´ JSON íŒŒì¼ì„ ê°€ì ¸ì˜µë‹ˆë‹¤)
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          persist-credentials: false
          fetch-depth: 0 # ëª¨ë“  ê¸°ë¡ì„ ê°€ì ¸ì™€ì•¼ JSON íŒŒì¼ ì—…ë°ì´íŠ¸ê°€ ì›í™œí•©ë‹ˆë‹¤.

      # 2. Python í™˜ê²½ ì„¤ì • (3.11)
      - name: Set up Python ${{ env.PYTHON_VERSION }}
        uses: actions/setup-python@v5
        with:
          python-version: ${{ env.PYTHON_VERSION }}

      # 3. í•„ìš”í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„¤ì¹˜ (requirements.txt ì‚¬ìš©)
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          # requirements.txtì— requests, pandas, beautifulsoup4 ë§Œ ìˆì–´ì•¼ í•©ë‹ˆë‹¤.
          pip install -r requirements.txt
          
      # 4. Python ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ (codes/02.2ë‹¨ê³„.py)
      - name: Run Python script
        # ğŸ’¡ ìŠ¤í¬ë¦½íŠ¸ì—ëŠ” ëª¨ë“  import êµ¬ë¬¸(requests, bs4, pandas, os, json, re)ì´ í¬í•¨ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.
        run: python codes/02.2ë‹¨ê³„.py

      # 5. ë³€ê²½ëœ íŒŒì¼ (nia.json) ìë™ ì»¤ë°‹ ë° í‘¸ì‹œ
      - name: Commit and Push changes
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          file_pattern: 'nia.json' # ğŸ‘ˆ ìŠ¤í¬ë¦½íŠ¸ê°€ ìƒì„±í•œ íŒŒì¼
          commit_message: 'Automated: Update NIA Web Crawler data'
          branch: main # ğŸ‘ˆ ì‚¬ìš©í•˜ëŠ” ë¸Œëœì¹˜ ì´ë¦„ì— ë§ê²Œ ìˆ˜ì •í•˜ì„¸ìš”
